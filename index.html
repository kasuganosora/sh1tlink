<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>文艺下载连接生成器 by kasuganosora</title>
    
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
    <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container" role="main">
        <div class="jumbotron">
            <h1>文艺下载连接生成器</h1>
            <p>支持http,ftp,磁力,电驴的下载连接</p>
        </div>
        
        <form>
            <div class="form-group">
                <label>原始下载连接</label>
                <input type="text" class="form-control" name="rawlink" id="rawlink">
            </div>
            <div class="form-group">
                <button id="encode-link">↓生成</button>
                <button id="decode-link">↑还原</button>
            </div>
             <div class="form-group">
                <label>文艺下载连接</label>
                <textarea rows="5" class="form-control" name="sh1tlink" id="sh1tlink"></textarea>
            </div>           
        </form>
      
    </div>
  <script>
  
  $("#encode-link").click(function(){
    var val = $("#rawlink").val().trim();
    var sh1tlink = $("#sh1tlink");
    sh1tlink.val("");
    
    if(val.length > 0) {
      try{
        val = sh1tEncode(val);
      }catch(e){
        alert(e);
        return false;
      }
      sh1tlink.val(val)
    }
    return false;  
  });
  
  
  $("#decode-link").click(function(){
    var val = $("#sh1tlink").val().trim();
    var rawlink = $("#rawlink");
    rawlink.val("");
    if(val.length > 0){
        try{
          val = sh1tDecode(val);
        }catch(e){
            alert(e);
            return false;
        }
        
        rawlink.val(val);
    }
    return false;
  });
  
  
  //-------------------------
var magnetDict = ["南", "無", "阿", "唎", "耶", "婆", "盧", "羯", "帝", "爍", "缽", "囉", "菩", "提", "薩", "埵", "摩", "訶", "迦", "尼", "唵", "皤", "罰", "曳", "數", "怛", "那", "寫", "悉", "吉", "栗", "伊", "蒙", "室", "佛", "楞", "馱", "謹", "墀", "醯", "哆", "沙", "咩", "他", "豆", "輸", "朋", "逝", "孕", "伽", "特", "姪", "羅", "夷", "度", "闍", "陀", "地", "麼", "穆", "隸", "參", "舍", "利","。"];
var ed2kDict = ["學", "而", "時", "習", "之", "美", "不", "亦", "說", "乎", "有", "朋", "自", "遠", "方", "來", "樂", "人", "知", "慍", "君", "子", "其", "為", "也", "孝", "弟", "好", "犯", "上", "者", "鮮", "矣", "作", "亂", "未", "務", "本", "立", "道", "生", "仁", "與", "敬", "父", "母", "尊", "師", "長", "卻", "的", "少", "極", "了", "絕", "對", "沒", "做", "首", "先", "要", "從", "根", "起","。"];

var httpDict = ["人", "之", "患", "無", "在", "好", "為", "師", "夫", "必", "自", "侮", "然", "後", "家", "毀", "而", "國", "伐", "皆", "太", "甲", "則", "曰", "武", "天", "作", "孽", "猶", "可", "違", "不", "活", "君", "此", "謂", "也", "三", "代", "得", "下", "以", "仁", "其", "失", "所", "廢", "興", "存", "亡", "者", "亦", "子", "保", "四", "海", "諸", "侯", "社", "稷", "卿", "大", "宗", "廟","。"];
var ftpDict = ["天", "下", "皆", "知", "美", "之", "为", "斯", "恶", "已", "善", "不", "故", "有", "无", "相", "生", "难", "易", "成", "长", "短", "形", "高", "倾", "音", "声", "和", "前", "後", "随", "是", "以", "圣", "人", "处", "事", "行", "言", "教", "万", "物", "作", "焉", "而", "辞", "恃", "功", "弗", "居", "夫", "惟", "去", "地", "久", "所", "能", "且", "者", "其", "自", "身", "先", "外","。"];

var base64Table = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";

function translate(dict,str){
    str = btoa(escape(str));
    var outChars = [];
    str.split("").forEach(function(c, index){
        inTableIndex = base64Table.indexOf(c);
        if(inTableIndex == -1){
            throw "char not in base64Table";
        }
        outChars.push(dict[inTableIndex]);
    });

    return outChars.join('');
}







function detranslate(dict,str){
    var outChars = [];
    str.split("").forEach(function(c, index){
        inTableIndex = dict.indexOf(c);
        if(inTableIndex == -1){
            throw "char not in base64Table";
        }
        outChars.push(base64Table[inTableIndex]);
    });

    return unescape(atob(outChars.join('')));
}






function sh1tEncode(str){
    protocol = ""
    tmp = str.split(/\:\?|:\/\//);
    if (tmp.length != 2){
        throw new Error("Not a Link");
    }

    protocol = tmp[0].toLowerCase();
    content = tmp[1];

    switch(protocol){
        case "magnet":
            content = translate(magnetDict,content);
            return "佛曰：" + content;
        case "ed2k":
            content = translate(ed2kDict,content);
            return "子曰：" + content;
        case "http":
            content = translate(httpDict,content);
            return "孟子曰：" + content;
        case "ftp":
            content = translate(ftDict,content);
            return "老子曰：" + content;               
        default:
            return "Error!";           
    }

}



function sh1tDecode(str){
    protocol = ""
    tmp = str.split("：");
    if (tmp.length != 2){
        throw new Error("Not a Link");
    }

    protocol = tmp[0].toLowerCase();
    content = tmp[1];
    switch(protocol){
        case "佛曰": 
            return "magnet:?" + detranslate(magnetDict,content);
        case "子曰":
            return "ed2k://" + detranslate(ed2kDict,content);
        case "孟子曰":
            return "http://" + detranslate(ed2kDict,content);
        case "老子曰":
            return "ftp://" + detranslate(ed2kDict,content);
        default:
            return "Error!"; 
    }
}
  </script>
  </body>
</html>
